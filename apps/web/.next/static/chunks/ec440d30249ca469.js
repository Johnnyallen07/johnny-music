(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,90290,e=>{"use strict";var r=e.i(43476),a=e.i(71645);e.i(66563);var t=e.i(62044),d=e.i(77543),s=e.i(12598);function o(){let[e,o]=(0,a.useState)([]),[i,l]=(0,a.useState)({}),[n,g]=(0,a.useState)(""),[c,u]=(0,a.useState)(""),[m,x]=(0,a.useState)(""),[h,b]=(0,a.useState)(""),[y,p]=(0,a.useState)(""),[f,k]=(0,a.useState)(""),[v,N]=(0,a.useState)(""),[j,w]=(0,a.useState)(""),[_,C]=(0,a.useState)(""),[E,S]=(0,a.useState)(""),[$,W]=(0,a.useState)(""),[z,M]=(0,a.useState)(!1),[A,P]=(0,a.useState)(!1),[D,F]=(0,a.useState)(""),{config:T,loading:B}=(0,t.useCategories)(),Z=T.categories||[],L=T.musicians||[],U=T.series||[],O=(0,d.useUploadMusic)(),K=(0,s.useQueryClient)();(0,a.useEffect)(()=>{Z.length>0&&!h&&b(Z[0].en)},[Z,h]),(0,a.useEffect)(()=>{L.length>0&&!n&&(g(L[0].en),u(L[0].zh))},[L,n]);let H=r=>{let a=[],t={...i};for(let d of r instanceof FileList?Array.from(r):r){if(d.size>0x3200000){alert(`文件 ${d.name} 大小不能超过50MB`);continue}if(!e.some(e=>e.name===d.name&&e.size===d.size)){a.push(d);let e=d.name.replace(/\.mp3$/,"");t[d.name]={title:e,titleZh:e}}}o(e=>[...e,...a]),l(t)},I=(e,r,a)=>{l(t=>({...t,[e]:{...t[e],[r]:a}}))},Q=async r=>{if(r.preventDefault(),0===e.length)return void alert("请选择至少一个要上传的MP3文件。");M(!0),W("准备上传...");let a=0,t=0;try{for(let r=0;r<e.length;r++){let d=e[r],s=i[d.name]||{title:d.name.replace(/\.mp3$/,""),titleZh:""};F(`正在上传 (${r+1}/${e.length}): ${d.name}`);try{await O.mutateAsync({file:d,musicInfo:{title:s.title,title_zh:s.titleZh,artist:"__NEW__"===n?E:n,artist_zh:"__NEW__"===n?c:L.find(e=>e.en===n)?.zh||c,performer:m,category:"__NEW__"===h?f:h,category_zh:y,series:"__NEW__"===v?_:v,series_zh:"__NEW__"===v?j:U.find(e=>e.en===v)?.zh||j,id:crypto.randomUUID()}}),a++}catch(e){console.error(`Failed to upload ${d.name}:`,e),t++}}K.invalidateQueries({queryKey:["music"]}),0===t?(W(`全部 ${a} 个文件上传成功！`),o([]),l({})):W(`上传完成: ${a} 成功, ${t} 失败。`),setTimeout(()=>{0===t&&W(""),F("")},3e3)}catch(r){console.error("Batch submission error:",r);let e=r instanceof Error?r.message:"发生网络错误。";W(`上传过程发生错误: ${e}`)}finally{M(!1)}};return(0,r.jsx)("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 flex flex-col justify-center items-center p-4",children:(0,r.jsxs)("div",{className:"max-w-4xl w-full bg-white dark:bg-gray-800 p-8 rounded-xl shadow-lg",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-6 text-center",children:"批量上传音乐"}),$&&(0,r.jsx)("div",{className:`mb-4 p-4 text-sm rounded-lg ${$.includes("失败")||$.includes("错误")?"text-red-700 bg-red-100 dark:bg-red-200 dark:text-red-800":"text-green-700 bg-green-100 dark:bg-green-200 dark:text-green-800"}`,role:"alert",children:(0,r.jsx)("span",{className:"font-medium",children:$})}),D&&(0,r.jsx)("div",{className:"mb-4 p-2 text-sm text-blue-700 bg-blue-100 dark:bg-blue-900 dark:text-blue-200 rounded-lg text-center",children:D}),(0,r.jsxs)("form",{onSubmit:Q,className:"space-y-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"file-upload",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"MP3 文件 (支持多选)"}),(0,r.jsx)("div",{className:`mt-1 flex justify-center px-6 pt-5 pb-6 border-2 ${A?"border-indigo-500":"border-gray-300 dark:border-gray-600"} border-dashed rounded-md`,onDragOver:e=>{e.preventDefault(),e.stopPropagation(),P(!0)},onDragLeave:e=>{e.preventDefault(),e.stopPropagation(),P(!1)},onDrop:e=>{e.preventDefault(),e.stopPropagation(),P(!1),e.dataTransfer.files&&e.dataTransfer.files.length>0&&H(e.dataTransfer.files)},children:(0,r.jsxs)("div",{className:"space-y-1 text-center",children:[(0,r.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48","aria-hidden":"true",children:(0,r.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,r.jsxs)("div",{className:"flex text-sm text-gray-600 dark:text-gray-400 justify-center",children:[(0,r.jsxs)("label",{htmlFor:"file-upload",className:"relative cursor-pointer bg-white dark:bg-gray-800 rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500",children:[(0,r.jsx)("span",{children:"选择文件"}),(0,r.jsx)("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",accept:".mp3",multiple:!0,onChange:e=>{e.target.files&&e.target.files.length>0&&H(e.target.files),e.target.value=""},disabled:z})]}),(0,r.jsx)("p",{className:"pl-1",children:"或拖放文件"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"单文件 MP3 小于 50MB"})]})})]}),e.length>0&&(0,r.jsxs)("div",{className:"space-y-4 max-h-96 overflow-y-auto p-2 border border-gray-200 dark:border-gray-700 rounded-md",children:[(0,r.jsxs)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 sticky top-0 bg-white dark:bg-gray-800 pb-2 border-b border-gray-200 dark:border-gray-700",children:["已选择 ",e.length," 个文件"]}),e.map((e,a)=>(0,r.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg relative",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{var r;let a;return r=e.name,o(e=>e.filter(e=>e.name!==r)),a={...i},void(delete a[r],l(a))},className:"absolute top-2 right-2 text-red-500 hover:text-red-700 text-sm",disabled:z,children:"删除"}),(0,r.jsxs)("div",{className:"mb-2 text-sm text-gray-500 dark:text-gray-400 font-mono break-all pr-8",children:[e.name," (",Math.round(e.size/1024/1024*100)/100," MB)"]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300",children:"Name (English)"}),(0,r.jsx)("input",{type:"text",value:i[e.name]?.title||"",onChange:r=>I(e.name,"title",r.target.value),disabled:z,className:"mt-1 block w-full px-2 py-1 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-sm shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm text-gray-900 dark:text-gray-100"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300",children:"名称 (中文)"}),(0,r.jsx)("input",{type:"text",value:i[e.name]?.titleZh||"",onChange:r=>I(e.name,"titleZh",r.target.value),disabled:z,className:"mt-1 block w-full px-2 py-1 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-sm shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm text-gray-900 dark:text-gray-100"})]})]})]},`${e.name}-${a}`))]}),(0,r.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[(0,r.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-4",children:"公共属性 (应用于所有文件)"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{htmlFor:"artist",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Musician / Composer (English)"}),(0,r.jsxs)("select",{id:"artist",value:n,onChange:e=>{let r=e.target.value;if(g(r),"__NEW__"===r)u(""),S("");else{let e=L.find(e=>e.en===r);e&&u(e.zh)}},disabled:z||B,className:"block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100",children:[L.map(e=>(0,r.jsx)("option",{value:e.en,children:e.en},e.id)),(0,r.jsx)("option",{value:"__NEW__",children:"Add New..."})]}),"__NEW__"===n&&(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,r.jsx)("input",{type:"text",value:E,onChange:e=>S(e.target.value),placeholder:"New Musician (EN)",disabled:z,className:"px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("input",{type:"text",id:"artistZh",value:c,onChange:e=>u(e.target.value),placeholder:"音乐家 (中文)",disabled:z,className:"flex-1 px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100"}),(0,r.jsx)("button",{type:"button",onClick:()=>{E&&(g(E),S(""))},disabled:z,className:"px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 whitespace-nowrap",children:"Add"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"performer",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Performer / 演奏者"}),(0,r.jsx)("input",{type:"text",id:"performer",value:m,onChange:e=>x(e.target.value),disabled:z,className:"mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Category (English)"}),(0,r.jsxs)("select",{id:"category",value:h,onChange:e=>{let r=e.target.value;b(r),"__NEW__"===r&&(p(""),k(""))},disabled:z||B,className:"mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100",children:[Z.map(e=>(0,r.jsx)("option",{value:e.en,children:e.en},e.id)),(0,r.jsx)("option",{value:"__NEW__",children:"Add New..."})]}),"__NEW__"===h&&(0,r.jsxs)("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,r.jsx)("input",{type:"text",value:f,onChange:e=>k(e.target.value),placeholder:"New Category (EN)",disabled:z,className:"px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("input",{type:"text",value:y,onChange:e=>p(e.target.value),placeholder:"新分类 (中文)",disabled:z,className:"flex-1 px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100"}),(0,r.jsx)("button",{type:"button",onClick:()=>{f&&(b(f),k(""))},disabled:z,className:"px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 whitespace-nowrap",children:"Add"})]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{htmlFor:"series",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Series (English)"}),(0,r.jsxs)("select",{id:"series",value:v,onChange:e=>{let r=e.target.value;if(N(r),"__NEW__"===r)w(""),C("");else{let e=U.find(e=>e.en===r);e?w(e.zh):""===r&&w("")}},disabled:z||B,className:"block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100",children:[(0,r.jsx)("option",{value:"",children:"None / Optional"}),U.map(e=>(0,r.jsx)("option",{value:e.en,children:e.en},e.id)),(0,r.jsx)("option",{value:"__NEW__",children:"Add New..."})]}),"__NEW__"===v&&(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,r.jsx)("input",{type:"text",value:_,onChange:e=>C(e.target.value),placeholder:"New Series (EN)",disabled:z,className:"px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100"}),(0,r.jsxs)("div",{className:"flex space-x-2",children:[(0,r.jsx)("input",{type:"text",id:"seriesZh",value:j,onChange:e=>w(e.target.value),placeholder:"系列 (中文)",disabled:z,className:"flex-1 px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100"}),(0,r.jsx)("button",{type:"button",onClick:()=>{_&&(N(_),C(""))},disabled:z,className:"px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 whitespace-nowrap",children:"Add"})]})]})]})]})]}),(0,r.jsx)("div",{children:(0,r.jsx)("button",{type:"submit",disabled:z||0===e.length,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:z?"正在提交...":`提交 (${e.length} 个文件)`})})]})]})})}e.s(["default",()=>o])}]);
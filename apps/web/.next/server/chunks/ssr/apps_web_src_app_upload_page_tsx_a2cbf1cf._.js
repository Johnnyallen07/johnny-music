module.exports=[5257,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(41101);var d=a.i(60567),e=a.i(6838),f=a.i(37927);function g(){let[a,g]=(0,c.useState)([]),[h,i]=(0,c.useState)({}),[j,k]=(0,c.useState)(""),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)(""),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)(!1),[H,I]=(0,c.useState)(!1),[J,K]=(0,c.useState)(""),{config:L,loading:M}=(0,d.useCategories)(),N=L.categories||[],O=L.musicians||[],P=L.series||[],Q=(0,e.useUploadMusic)(),R=(0,f.useQueryClient)();(0,c.useEffect)(()=>{N.length>0&&!p&&q(N[0].en)},[N,p]),(0,c.useEffect)(()=>{O.length>0&&!j&&(k(O[0].en),m(O[0].zh))},[O,j]);let S=b=>{let c=[],d={...h};for(let e of b instanceof FileList?Array.from(b):b){if(e.size>0x3200000){alert(`文件 ${e.name} 大小不能超过50MB`);continue}if(!a.some(a=>a.name===e.name&&a.size===e.size)){c.push(e);let a=e.name.replace(/\.mp3$/,"");d[e.name]={title:a,titleZh:a}}}g(a=>[...a,...c]),i(d)},T=(a,b,c)=>{i(d=>({...d,[a]:{...d[a],[b]:c}}))},U=async b=>{if(b.preventDefault(),0===a.length)return void alert("请选择至少一个要上传的MP3文件。");G(!0),E("准备上传...");let c=0,d=0;try{for(let b=0;b<a.length;b++){let e=a[b],f=h[e.name]||{title:e.name.replace(/\.mp3$/,""),titleZh:""};K(`正在上传 (${b+1}/${a.length}): ${e.name}`);try{await Q.mutateAsync({file:e,musicInfo:{title:f.title,title_zh:f.titleZh,artist:"__NEW__"===j?B:j,artist_zh:"__NEW__"===j?l:O.find(a=>a.en===j)?.zh||l,performer:n,category:"__NEW__"===p?t:p,category_zh:r,series:"__NEW__"===v?z:v,series_zh:"__NEW__"===v?x:P.find(a=>a.en===v)?.zh||x,id:crypto.randomUUID()}}),c++}catch(a){console.error(`Failed to upload ${e.name}:`,a),d++}}R.invalidateQueries({queryKey:["music"]}),0===d?(E(`全部 ${c} 个文件上传成功！`),g([]),i({})):E(`上传完成: ${c} 成功, ${d} 失败。`),setTimeout(()=>{0===d&&E(""),K("")},3e3)}catch(b){console.error("Batch submission error:",b);let a=b instanceof Error?b.message:"发生网络错误。";E(`上传过程发生错误: ${a}`)}finally{G(!1)}};return(0,b.jsx)("div",{className:"min-h-screen bg-gray-100 dark:bg-gray-900 flex flex-col justify-center items-center p-4",children:(0,b.jsxs)("div",{className:"max-w-4xl w-full bg-white dark:bg-gray-800 p-8 rounded-xl shadow-lg",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-6 text-center",children:"批量上传音乐"}),D&&(0,b.jsx)("div",{className:`mb-4 p-4 text-sm rounded-lg ${D.includes("失败")||D.includes("错误")?"text-red-700 bg-red-100 dark:bg-red-200 dark:text-red-800":"text-green-700 bg-green-100 dark:bg-green-200 dark:text-green-800"}`,role:"alert",children:(0,b.jsx)("span",{className:"font-medium",children:D})}),J&&(0,b.jsx)("div",{className:"mb-4 p-2 text-sm text-blue-700 bg-blue-100 dark:bg-blue-900 dark:text-blue-200 rounded-lg text-center",children:J}),(0,b.jsxs)("form",{onSubmit:U,className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"file-upload",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"MP3 文件 (支持多选)"}),(0,b.jsx)("div",{className:`mt-1 flex justify-center px-6 pt-5 pb-6 border-2 ${H?"border-indigo-500":"border-gray-300 dark:border-gray-600"} border-dashed rounded-md`,onDragOver:a=>{a.preventDefault(),a.stopPropagation(),I(!0)},onDragLeave:a=>{a.preventDefault(),a.stopPropagation(),I(!1)},onDrop:a=>{a.preventDefault(),a.stopPropagation(),I(!1),a.dataTransfer.files&&a.dataTransfer.files.length>0&&S(a.dataTransfer.files)},children:(0,b.jsxs)("div",{className:"space-y-1 text-center",children:[(0,b.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48","aria-hidden":"true",children:(0,b.jsx)("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,b.jsxs)("div",{className:"flex text-sm text-gray-600 dark:text-gray-400 justify-center",children:[(0,b.jsxs)("label",{htmlFor:"file-upload",className:"relative cursor-pointer bg-white dark:bg-gray-800 rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500",children:[(0,b.jsx)("span",{children:"选择文件"}),(0,b.jsx)("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",accept:".mp3",multiple:!0,onChange:a=>{a.target.files&&a.target.files.length>0&&S(a.target.files),a.target.value=""},disabled:F})]}),(0,b.jsx)("p",{className:"pl-1",children:"或拖放文件"})]}),(0,b.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"单文件 MP3 小于 50MB"})]})})]}),a.length>0&&(0,b.jsxs)("div",{className:"space-y-4 max-h-96 overflow-y-auto p-2 border border-gray-200 dark:border-gray-700 rounded-md",children:[(0,b.jsxs)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 sticky top-0 bg-white dark:bg-gray-800 pb-2 border-b border-gray-200 dark:border-gray-700",children:["已选择 ",a.length," 个文件"]}),a.map((a,c)=>(0,b.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg relative",children:[(0,b.jsx)("button",{type:"button",onClick:()=>{var b;let c;return b=a.name,g(a=>a.filter(a=>a.name!==b)),c={...h},void(delete c[b],i(c))},className:"absolute top-2 right-2 text-red-500 hover:text-red-700 text-sm",disabled:F,children:"删除"}),(0,b.jsxs)("div",{className:"mb-2 text-sm text-gray-500 dark:text-gray-400 font-mono break-all pr-8",children:[a.name," (",Math.round(a.size/1024/1024*100)/100," MB)"]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300",children:"Name (English)"}),(0,b.jsx)("input",{type:"text",value:h[a.name]?.title||"",onChange:b=>T(a.name,"title",b.target.value),disabled:F,className:"mt-1 block w-full px-2 py-1 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-sm shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm text-gray-900 dark:text-gray-100"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300",children:"名称 (中文)"}),(0,b.jsx)("input",{type:"text",value:h[a.name]?.titleZh||"",onChange:b=>T(a.name,"titleZh",b.target.value),disabled:F,className:"mt-1 block w-full px-2 py-1 bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-sm shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-sm text-gray-900 dark:text-gray-100"})]})]})]},`${a.name}-${c}`))]}),(0,b.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-4 rounded-lg border border-gray-200 dark:border-gray-700",children:[(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-4",children:"公共属性 (应用于所有文件)"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{htmlFor:"artist",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Musician / Composer (English)"}),(0,b.jsxs)("select",{id:"artist",value:j,onChange:a=>{let b=a.target.value;if(k(b),"__NEW__"===b)m(""),C("");else{let a=O.find(a=>a.en===b);a&&m(a.zh)}},disabled:F||M,className:"block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100",children:[O.map(a=>(0,b.jsx)("option",{value:a.en,children:a.en},a.id)),(0,b.jsx)("option",{value:"__NEW__",children:"Add New..."})]}),"__NEW__"===j&&(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,b.jsx)("input",{type:"text",value:B,onChange:a=>C(a.target.value),placeholder:"New Musician (EN)",disabled:F,className:"px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100"}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)("input",{type:"text",id:"artistZh",value:l,onChange:a=>m(a.target.value),placeholder:"音乐家 (中文)",disabled:F,className:"flex-1 px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100"}),(0,b.jsx)("button",{type:"button",onClick:()=>{B&&(k(B),C(""))},disabled:F,className:"px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 whitespace-nowrap",children:"Add"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"performer",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Performer / 演奏者"}),(0,b.jsx)("input",{type:"text",id:"performer",value:n,onChange:a=>o(a.target.value),disabled:F,className:"mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{htmlFor:"category",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Category (English)"}),(0,b.jsxs)("select",{id:"category",value:p,onChange:a=>{let b=a.target.value;q(b),"__NEW__"===b&&(s(""),u(""))},disabled:F||M,className:"mt-1 block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100",children:[N.map(a=>(0,b.jsx)("option",{value:a.en,children:a.en},a.id)),(0,b.jsx)("option",{value:"__NEW__",children:"Add New..."})]}),"__NEW__"===p&&(0,b.jsxs)("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,b.jsx)("input",{type:"text",value:t,onChange:a=>u(a.target.value),placeholder:"New Category (EN)",disabled:F,className:"px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100"}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)("input",{type:"text",value:r,onChange:a=>s(a.target.value),placeholder:"新分类 (中文)",disabled:F,className:"flex-1 px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100"}),(0,b.jsx)("button",{type:"button",onClick:()=>{t&&(q(t),u(""))},disabled:F,className:"px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 whitespace-nowrap",children:"Add"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{htmlFor:"series",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Series (English)"}),(0,b.jsxs)("select",{id:"series",value:v,onChange:a=>{let b=a.target.value;if(w(b),"__NEW__"===b)y(""),A("");else{let a=P.find(a=>a.en===b);a?y(a.zh):""===b&&y("")}},disabled:F||M,className:"block w-full px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100",children:[(0,b.jsx)("option",{value:"",children:"None / Optional"}),P.map(a=>(0,b.jsx)("option",{value:a.en,children:a.en},a.id)),(0,b.jsx)("option",{value:"__NEW__",children:"Add New..."})]}),"__NEW__"===v&&(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[(0,b.jsx)("input",{type:"text",value:z,onChange:a=>A(a.target.value),placeholder:"New Series (EN)",disabled:F,className:"px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100"}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)("input",{type:"text",id:"seriesZh",value:x,onChange:a=>y(a.target.value),placeholder:"系列 (中文)",disabled:F,className:"flex-1 px-3 py-2 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 dark:text-gray-100"}),(0,b.jsx)("button",{type:"button",onClick:()=>{z&&(w(z),A(""))},disabled:F,className:"px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 whitespace-nowrap",children:"Add"})]})]})]})]})]}),(0,b.jsx)("div",{children:(0,b.jsx)("button",{type:"submit",disabled:F||0===a.length,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50 disabled:cursor-not-allowed",children:F?"正在提交...":`提交 (${a.length} 个文件)`})})]})]})})}a.s(["default",()=>g])}];

//# sourceMappingURL=apps_web_src_app_upload_page_tsx_a2cbf1cf._.js.map